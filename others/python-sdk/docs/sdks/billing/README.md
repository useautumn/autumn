# Billing

## Overview

### Available Operations

* [attach](#attach) - Attaches a plan to a customer. Handles new subscriptions, upgrades and downgrades.

Use this endpoint to subscribe a customer to a plan, upgrade/downgrade between plans, or add an add-on product.
* [preview_attach](#preview_attach) - Previews the billing changes that would occur when attaching a plan, without actually making any changes.

Use this endpoint to show customers what they will be charged before confirming a subscription change.
* [update](#update) - Updates an existing subscription. Use to modify feature quantities, cancel, or change plan configuration.

Use this endpoint to update prepaid quantities, cancel a subscription (immediately or at end of cycle), or modify subscription settings.
* [preview_update](#preview_update) - Previews the billing changes that would occur when updating a subscription, without actually making any changes.

Use this endpoint to show customers prorated charges or refunds before confirming subscription modifications.
* [open_customer_portal](#open_customer_portal) - Create a billing portal session for a customer to manage their subscription.

## attach

Attaches a plan to a customer. Handles new subscriptions, upgrades and downgrades.

Use this endpoint to subscribe a customer to a plan, upgrade/downgrade between plans, or add an add-on product.

### Example Usage

<!-- UsageSnippet language="python" operationID="billingAttach" method="post" path="/v1/billing.attach" -->
```python
from autumn_sdk import Autumn


with Autumn(
    x_api_version="2.1",
    secret_key="<YOUR_BEARER_TOKEN_HERE>",
) as autumn:

    res = autumn.billing.attach(customer_id="cus_123", plan_id="pro_plan")

    # Handle response
    print(res)

```

### Parameters

| Parameter                                                                                                                                                                                                                | Type                                                                                                                                                                                                                     | Required                                                                                                                                                                                                                 | Description                                                                                                                                                                                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `customer_id`                                                                                                                                                                                                            | *str*                                                                                                                                                                                                                    | :heavy_check_mark:                                                                                                                                                                                                       | The ID of the customer to attach the plan to.                                                                                                                                                                            |
| `plan_id`                                                                                                                                                                                                                | *str*                                                                                                                                                                                                                    | :heavy_check_mark:                                                                                                                                                                                                       | The ID of the plan.                                                                                                                                                                                                      |
| `entity_id`                                                                                                                                                                                                              | *Optional[str]*                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                       | The ID of the entity to attach the plan to.                                                                                                                                                                              |
| `feature_quantities`                                                                                                                                                                                                     | List[[models.BillingAttachFeatureQuantity](../../models/billingattachfeaturequantity.md)]                                                                                                                                | :heavy_minus_sign:                                                                                                                                                                                                       | If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan.                   |
| `version`                                                                                                                                                                                                                | *Optional[float]*                                                                                                                                                                                                        | :heavy_minus_sign:                                                                                                                                                                                                       | The version of the plan to attach.                                                                                                                                                                                       |
| `free_trial`                                                                                                                                                                                                             | [OptionalNullable[models.BillingAttachFreeTrial]](../../models/billingattachfreetrial.md)                                                                                                                                | :heavy_minus_sign:                                                                                                                                                                                                       | Override the plan's default free trial. Pass an object to set a custom trial, or null to remove the trial entirely.                                                                                                      |
| `customize`                                                                                                                                                                                                              | [Optional[models.BillingAttachCustomize]](../../models/billingattachcustomize.md)                                                                                                                                        | :heavy_minus_sign:                                                                                                                                                                                                       | Customize the plan to attach. Can either override the price of the plan, the items in the plan, or both.                                                                                                                 |
| `invoice_mode`                                                                                                                                                                                                           | [Optional[models.BillingAttachInvoiceMode]](../../models/billingattachinvoicemode.md)                                                                                                                                    | :heavy_minus_sign:                                                                                                                                                                                                       | Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method.                                                |
| `billing_behavior`                                                                                                                                                                                                       | [Optional[models.BillingAttachBillingBehavior]](../../models/billingattachbillingbehavior.md)                                                                                                                            | :heavy_minus_sign:                                                                                                                                                                                                       | How to handle billing when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'next_cycle_only' skips creating any charges and applies the change at the next billing cycle. |
| `discounts`                                                                                                                                                                                                              | List[[models.BillingAttachDiscountUnion](../../models/billingattachdiscountunion.md)]                                                                                                                                    | :heavy_minus_sign:                                                                                                                                                                                                       | List of discounts to apply. Each discount can be an Autumn reward ID, Stripe coupon ID, or Stripe promotion code.                                                                                                        |
| `success_url`                                                                                                                                                                                                            | *Optional[str]*                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                       | URL to redirect to after successful checkout.                                                                                                                                                                            |
| `new_billing_subscription`                                                                                                                                                                                               | *Optional[bool]*                                                                                                                                                                                                         | :heavy_minus_sign:                                                                                                                                                                                                       | Only applicable when the customer has an existing Stripe subscription. If true, creates a new separate subscription instead of merging into the existing one.                                                            |
| `plan_schedule`                                                                                                                                                                                                          | [Optional[models.BillingAttachPlanSchedule]](../../models/billingattachplanschedule.md)                                                                                                                                  | :heavy_minus_sign:                                                                                                                                                                                                       | When the plan change should take effect. 'immediate' applies now, 'end_of_cycle' schedules for the end of the current billing cycle. By default, upgrades are immediate and downgrades are scheduled.                    |
| `retries`                                                                                                                                                                                                                | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)                                                                                                                                                         | :heavy_minus_sign:                                                                                                                                                                                                       | Configuration to override the default retry behavior of the client.                                                                                                                                                      |

### Response

**[models.BillingAttachResponse](../../models/billingattachresponse.md)**

### Errors

| Error Type                | Status Code               | Content Type              |
| ------------------------- | ------------------------- | ------------------------- |
| errors.AutumnDefaultError | 4XX, 5XX                  | \*/\*                     |

## preview_attach

Previews the billing changes that would occur when attaching a plan, without actually making any changes.

Use this endpoint to show customers what they will be charged before confirming a subscription change.

### Example Usage

<!-- UsageSnippet language="python" operationID="previewAttach" method="post" path="/v1/billing.preview_attach" -->
```python
from autumn_sdk import Autumn


with Autumn(
    x_api_version="2.1",
    secret_key="<YOUR_BEARER_TOKEN_HERE>",
) as autumn:

    res = autumn.billing.preview_attach(customer_id="cus_123", plan_id="pro_plan")

    # Handle response
    print(res)

```

### Parameters

| Parameter                                                                                                                                                                                                                | Type                                                                                                                                                                                                                     | Required                                                                                                                                                                                                                 | Description                                                                                                                                                                                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `customer_id`                                                                                                                                                                                                            | *str*                                                                                                                                                                                                                    | :heavy_check_mark:                                                                                                                                                                                                       | The ID of the customer to attach the plan to.                                                                                                                                                                            |
| `plan_id`                                                                                                                                                                                                                | *str*                                                                                                                                                                                                                    | :heavy_check_mark:                                                                                                                                                                                                       | The ID of the plan.                                                                                                                                                                                                      |
| `entity_id`                                                                                                                                                                                                              | *Optional[str]*                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                       | The ID of the entity to attach the plan to.                                                                                                                                                                              |
| `feature_quantities`                                                                                                                                                                                                     | List[[models.PreviewAttachFeatureQuantity](../../models/previewattachfeaturequantity.md)]                                                                                                                                | :heavy_minus_sign:                                                                                                                                                                                                       | If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan.                   |
| `version`                                                                                                                                                                                                                | *Optional[float]*                                                                                                                                                                                                        | :heavy_minus_sign:                                                                                                                                                                                                       | The version of the plan to attach.                                                                                                                                                                                       |
| `free_trial`                                                                                                                                                                                                             | [OptionalNullable[models.PreviewAttachFreeTrial]](../../models/previewattachfreetrial.md)                                                                                                                                | :heavy_minus_sign:                                                                                                                                                                                                       | Override the plan's default free trial. Pass an object to set a custom trial, or null to remove the trial entirely.                                                                                                      |
| `customize`                                                                                                                                                                                                              | [Optional[models.PreviewAttachCustomize]](../../models/previewattachcustomize.md)                                                                                                                                        | :heavy_minus_sign:                                                                                                                                                                                                       | Customize the plan to attach. Can either override the price of the plan, the items in the plan, or both.                                                                                                                 |
| `invoice_mode`                                                                                                                                                                                                           | [Optional[models.PreviewAttachInvoiceMode]](../../models/previewattachinvoicemode.md)                                                                                                                                    | :heavy_minus_sign:                                                                                                                                                                                                       | Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method.                                                |
| `billing_behavior`                                                                                                                                                                                                       | [Optional[models.PreviewAttachBillingBehavior]](../../models/previewattachbillingbehavior.md)                                                                                                                            | :heavy_minus_sign:                                                                                                                                                                                                       | How to handle billing when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'next_cycle_only' skips creating any charges and applies the change at the next billing cycle. |
| `discounts`                                                                                                                                                                                                              | List[[models.PreviewAttachDiscountUnion](../../models/previewattachdiscountunion.md)]                                                                                                                                    | :heavy_minus_sign:                                                                                                                                                                                                       | List of discounts to apply. Each discount can be an Autumn reward ID, Stripe coupon ID, or Stripe promotion code.                                                                                                        |
| `success_url`                                                                                                                                                                                                            | *Optional[str]*                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                       | URL to redirect to after successful checkout.                                                                                                                                                                            |
| `new_billing_subscription`                                                                                                                                                                                               | *Optional[bool]*                                                                                                                                                                                                         | :heavy_minus_sign:                                                                                                                                                                                                       | Only applicable when the customer has an existing Stripe subscription. If true, creates a new separate subscription instead of merging into the existing one.                                                            |
| `plan_schedule`                                                                                                                                                                                                          | [Optional[models.PreviewAttachPlanSchedule]](../../models/previewattachplanschedule.md)                                                                                                                                  | :heavy_minus_sign:                                                                                                                                                                                                       | When the plan change should take effect. 'immediate' applies now, 'end_of_cycle' schedules for the end of the current billing cycle. By default, upgrades are immediate and downgrades are scheduled.                    |
| `retries`                                                                                                                                                                                                                | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)                                                                                                                                                         | :heavy_minus_sign:                                                                                                                                                                                                       | Configuration to override the default retry behavior of the client.                                                                                                                                                      |

### Response

**[models.PreviewAttachResponse](../../models/previewattachresponse.md)**

### Errors

| Error Type                | Status Code               | Content Type              |
| ------------------------- | ------------------------- | ------------------------- |
| errors.AutumnDefaultError | 4XX, 5XX                  | \*/\*                     |

## update

Updates an existing subscription. Use to modify feature quantities, cancel, or change plan configuration.

Use this endpoint to update prepaid quantities, cancel a subscription (immediately or at end of cycle), or modify subscription settings.

### Example Usage

<!-- UsageSnippet language="python" operationID="billingUpdate" method="post" path="/v1/billing.update" -->
```python
from autumn_sdk import Autumn


with Autumn(
    x_api_version="2.1",
    secret_key="<YOUR_BEARER_TOKEN_HERE>",
) as autumn:

    res = autumn.billing.update(customer_id="cus_123", plan_id="pro_plan", feature_quantities=[
        {
            "feature_id": "seats",
            "quantity": 10,
        },
    ])

    # Handle response
    print(res)

```

### Parameters

| Parameter                                                                                                                                                                                                                | Type                                                                                                                                                                                                                     | Required                                                                                                                                                                                                                 | Description                                                                                                                                                                                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `customer_id`                                                                                                                                                                                                            | *str*                                                                                                                                                                                                                    | :heavy_check_mark:                                                                                                                                                                                                       | The ID of the customer to attach the plan to.                                                                                                                                                                            |
| `plan_id`                                                                                                                                                                                                                | *str*                                                                                                                                                                                                                    | :heavy_check_mark:                                                                                                                                                                                                       | The ID of the plan.                                                                                                                                                                                                      |
| `entity_id`                                                                                                                                                                                                              | *Optional[str]*                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                       | The ID of the entity to attach the plan to.                                                                                                                                                                              |
| `feature_quantities`                                                                                                                                                                                                     | List[[models.BillingUpdateFeatureQuantity](../../models/billingupdatefeaturequantity.md)]                                                                                                                                | :heavy_minus_sign:                                                                                                                                                                                                       | If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan.                   |
| `version`                                                                                                                                                                                                                | *Optional[float]*                                                                                                                                                                                                        | :heavy_minus_sign:                                                                                                                                                                                                       | The version of the plan to attach.                                                                                                                                                                                       |
| `free_trial`                                                                                                                                                                                                             | [OptionalNullable[models.BillingUpdateFreeTrial]](../../models/billingupdatefreetrial.md)                                                                                                                                | :heavy_minus_sign:                                                                                                                                                                                                       | Override the plan's default free trial. Pass an object to set a custom trial, or null to remove the trial entirely.                                                                                                      |
| `customize`                                                                                                                                                                                                              | [Optional[models.BillingUpdateCustomize]](../../models/billingupdatecustomize.md)                                                                                                                                        | :heavy_minus_sign:                                                                                                                                                                                                       | Customize the plan to attach. Can either override the price of the plan, the items in the plan, or both.                                                                                                                 |
| `invoice_mode`                                                                                                                                                                                                           | [Optional[models.BillingUpdateInvoiceMode]](../../models/billingupdateinvoicemode.md)                                                                                                                                    | :heavy_minus_sign:                                                                                                                                                                                                       | Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method.                                                |
| `billing_behavior`                                                                                                                                                                                                       | [Optional[models.BillingUpdateBillingBehavior]](../../models/billingupdatebillingbehavior.md)                                                                                                                            | :heavy_minus_sign:                                                                                                                                                                                                       | How to handle billing when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'next_cycle_only' skips creating any charges and applies the change at the next billing cycle. |
| `cancel_action`                                                                                                                                                                                                          | [Optional[models.BillingUpdateCancelAction]](../../models/billingupdatecancelaction.md)                                                                                                                                  | :heavy_minus_sign:                                                                                                                                                                                                       | Action to perform for cancellation. 'cancel_immediately' cancels now with prorated refund, 'cancel_end_of_cycle' cancels at period end, 'uncancel' reverses a pending cancellation.                                      |
| `retries`                                                                                                                                                                                                                | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)                                                                                                                                                         | :heavy_minus_sign:                                                                                                                                                                                                       | Configuration to override the default retry behavior of the client.                                                                                                                                                      |

### Response

**[models.BillingUpdateResponse](../../models/billingupdateresponse.md)**

### Errors

| Error Type                | Status Code               | Content Type              |
| ------------------------- | ------------------------- | ------------------------- |
| errors.AutumnDefaultError | 4XX, 5XX                  | \*/\*                     |

## preview_update

Previews the billing changes that would occur when updating a subscription, without actually making any changes.

Use this endpoint to show customers prorated charges or refunds before confirming subscription modifications.

### Example Usage

<!-- UsageSnippet language="python" operationID="previewUpdate" method="post" path="/v1/billing.preview_update" -->
```python
from autumn_sdk import Autumn


with Autumn(
    x_api_version="2.1",
    secret_key="<YOUR_BEARER_TOKEN_HERE>",
) as autumn:

    res = autumn.billing.preview_update(customer_id="cus_123", plan_id="pro_plan", feature_quantities=[
        {
            "feature_id": "seats",
            "quantity": 15,
        },
    ])

    # Handle response
    print(res)

```

### Parameters

| Parameter                                                                                                                                                                                                                | Type                                                                                                                                                                                                                     | Required                                                                                                                                                                                                                 | Description                                                                                                                                                                                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `customer_id`                                                                                                                                                                                                            | *str*                                                                                                                                                                                                                    | :heavy_check_mark:                                                                                                                                                                                                       | The ID of the customer to attach the plan to.                                                                                                                                                                            |
| `plan_id`                                                                                                                                                                                                                | *str*                                                                                                                                                                                                                    | :heavy_check_mark:                                                                                                                                                                                                       | The ID of the plan.                                                                                                                                                                                                      |
| `entity_id`                                                                                                                                                                                                              | *Optional[str]*                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                       | The ID of the entity to attach the plan to.                                                                                                                                                                              |
| `feature_quantities`                                                                                                                                                                                                     | List[[models.PreviewUpdateFeatureQuantity](../../models/previewupdatefeaturequantity.md)]                                                                                                                                | :heavy_minus_sign:                                                                                                                                                                                                       | If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan.                   |
| `version`                                                                                                                                                                                                                | *Optional[float]*                                                                                                                                                                                                        | :heavy_minus_sign:                                                                                                                                                                                                       | The version of the plan to attach.                                                                                                                                                                                       |
| `free_trial`                                                                                                                                                                                                             | [OptionalNullable[models.PreviewUpdateFreeTrial]](../../models/previewupdatefreetrial.md)                                                                                                                                | :heavy_minus_sign:                                                                                                                                                                                                       | Override the plan's default free trial. Pass an object to set a custom trial, or null to remove the trial entirely.                                                                                                      |
| `customize`                                                                                                                                                                                                              | [Optional[models.PreviewUpdateCustomize]](../../models/previewupdatecustomize.md)                                                                                                                                        | :heavy_minus_sign:                                                                                                                                                                                                       | Customize the plan to attach. Can either override the price of the plan, the items in the plan, or both.                                                                                                                 |
| `invoice_mode`                                                                                                                                                                                                           | [Optional[models.PreviewUpdateInvoiceMode]](../../models/previewupdateinvoicemode.md)                                                                                                                                    | :heavy_minus_sign:                                                                                                                                                                                                       | Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method.                                                |
| `billing_behavior`                                                                                                                                                                                                       | [Optional[models.PreviewUpdateBillingBehavior]](../../models/previewupdatebillingbehavior.md)                                                                                                                            | :heavy_minus_sign:                                                                                                                                                                                                       | How to handle billing when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'next_cycle_only' skips creating any charges and applies the change at the next billing cycle. |
| `cancel_action`                                                                                                                                                                                                          | [Optional[models.PreviewUpdateCancelAction]](../../models/previewupdatecancelaction.md)                                                                                                                                  | :heavy_minus_sign:                                                                                                                                                                                                       | Action to perform for cancellation. 'cancel_immediately' cancels now with prorated refund, 'cancel_end_of_cycle' cancels at period end, 'uncancel' reverses a pending cancellation.                                      |
| `retries`                                                                                                                                                                                                                | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)                                                                                                                                                         | :heavy_minus_sign:                                                                                                                                                                                                       | Configuration to override the default retry behavior of the client.                                                                                                                                                      |

### Response

**[models.PreviewUpdateResponse](../../models/previewupdateresponse.md)**

### Errors

| Error Type                | Status Code               | Content Type              |
| ------------------------- | ------------------------- | ------------------------- |
| errors.AutumnDefaultError | 4XX, 5XX                  | \*/\*                     |

## open_customer_portal

Create a billing portal session for a customer to manage their subscription.

### Example Usage

<!-- UsageSnippet language="python" operationID="openCustomerPortal" method="post" path="/v1/billing.open_customer_portal" -->
```python
from autumn_sdk import Autumn


with Autumn(
    x_api_version="2.1",
    secret_key="<YOUR_BEARER_TOKEN_HERE>",
) as autumn:

    res = autumn.billing.open_customer_portal(customer_id="cus_123", return_url="https://useautumn.com")

    # Handle response
    print(res)

```

### Parameters

| Parameter                                                                               | Type                                                                                    | Required                                                                                | Description                                                                             |
| --------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| `customer_id`                                                                           | *str*                                                                                   | :heavy_check_mark:                                                                      | The ID of the customer to open the billing portal for.                                  |
| `configuration_id`                                                                      | *Optional[str]*                                                                         | :heavy_minus_sign:                                                                      | Stripe billing portal configuration ID. Create configurations in your Stripe dashboard. |
| `return_url`                                                                            | *Optional[str]*                                                                         | :heavy_minus_sign:                                                                      | URL to redirect to when back button is clicked in the billing portal                    |
| `retries`                                                                               | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)                        | :heavy_minus_sign:                                                                      | Configuration to override the default retry behavior of the client.                     |

### Response

**[models.OpenCustomerPortalResponse](../../models/opencustomerportalresponse.md)**

### Errors

| Error Type                | Status Code               | Content Type              |
| ------------------------- | ------------------------- | ------------------------- |
| errors.AutumnDefaultError | 4XX, 5XX                  | \*/\*                     |