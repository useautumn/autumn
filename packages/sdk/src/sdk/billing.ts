/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { billingAttach } from "../funcs/billing-attach.js";
import { billingMultiAttach } from "../funcs/billing-multi-attach.js";
import { billingOpenCustomerPortal } from "../funcs/billing-open-customer-portal.js";
import { billingPreviewAttach } from "../funcs/billing-preview-attach.js";
import { billingPreviewMultiAttach } from "../funcs/billing-preview-multi-attach.js";
import { billingPreviewUpdate } from "../funcs/billing-preview-update.js";
import { billingSetupPayment } from "../funcs/billing-setup-payment.js";
import { billingUpdate } from "../funcs/billing-update.js";
import { ClientSDK, RequestOptions } from "../lib/sdks.js";
import * as models from "../models/index.js";
import { unwrapAsync } from "../types/fp.js";

export class Billing extends ClientSDK {
  /**
   * Attaches a plan to a customer. Handles new subscriptions, upgrades and downgrades.
   *
   * Use this endpoint to subscribe a customer to a plan, upgrade/downgrade between plans, or add an add-on product.
   *
   * @example
   * ```typescript
   * // Attach a plan to a customer
   * const response = await client.billing.attach({ customerId: "cus_123", planId: "pro_plan" });
   * ```
   *
   * @example
   * ```typescript
   * // Attach with a free trial
   * const response = await client.billing.attach({ customerId: "cus_123", planId: "pro_plan", freeTrial: {"durationLength":14,"durationType":"day"} });
   * ```
   *
   * @example
   * ```typescript
   * // Attach with custom pricing
   * const response = await client.billing.attach({ customerId: "cus_123", planId: "pro_plan", customize: {"price":{"amount":4900,"interval":"month"}} });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plan to.
   * @param entityId - The ID of the entity to attach the plan to. (optional)
   * @param planId - The ID of the plan.
   * @param featureQuantities - If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan. (optional)
   * @param version - The version of the plan to attach. (optional)
   * @param customize - Customize the plan to attach. Can override the price, items, free trial, or a combination. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method. (optional)
   * @param prorationBehavior - How to handle proration when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'none' skips creating any charges. (optional)
   * @param discounts - List of discounts to apply. Each discount can be an Autumn reward ID, Stripe coupon ID, or Stripe promotion code. (optional)
   * @param successUrl - URL to redirect to after successful checkout. (optional)
   * @param newBillingSubscription - Only applicable when the customer has an existing Stripe subscription. If true, creates a new separate subscription instead of merging into the existing one. (optional)
   * @param planSchedule - When the plan change should take effect. 'immediate' applies now, 'end_of_cycle' schedules for the end of the current billing cycle. By default, upgrades are immediate and downgrades are scheduled. (optional)
   * @param checkoutSessionParams - Additional parameters to pass into the creation of the Stripe checkout session. (optional)
   *
   * @returns A billing response with customer ID, invoice details, and payment URL (if checkout required).
   */
  async attach(
    request: models.AttachParams,
    options?: RequestOptions,
  ): Promise<models.AttachResponse> {
    return unwrapAsync(billingAttach(
      this,
      request,
      options,
    ));
  }

  /**
   * Attaches multiple plans to a customer in a single request. Creates a single Stripe subscription with all plans consolidated.
   *
   * Use this endpoint when you need to subscribe a customer to multiple plans at once, such as a base plan plus add-ons, or to create a bundle of products.
   *
   * @example
   * ```typescript
   * // Attach multiple plans to a customer
   * const response = await client.billing.multiAttach({ customerId: "cus_123", plans: [{"planId":"pro_plan"},{"planId":"addon_seats","featureQuantities":[{"featureId":"seats","quantity":5}]}] });
   * ```
   *
   * @example
   * ```typescript
   * // Attach with free trial applied to all plans
   * const response = await client.billing.multiAttach({ customerId: "cus_123", plans: [{"planId":"pro_plan"},{"planId":"addon_storage"}], freeTrial: {"durationLength":14,"durationType":"day"} });
   * ```
   *
   * @example
   * ```typescript
   * // Attach with custom pricing on one plan
   * const response = await client.billing.multiAttach({ customerId: "cus_123", plans: [{"planId":"pro_plan","customize":{"price":{"amount":4900,"interval":"month"}}},{"planId":"addon_support"}] });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plans to.
   * @param entityId - The ID of the entity to attach the plans to. (optional)
   * @param plans - The list of plans to attach to the customer.
   * @param freeTrial - Free trial configuration applied to all plans. Pass an object to set a custom trial, or null to remove any trial. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. (optional)
   * @param discounts - List of discounts to apply. Each discount can be an Autumn reward ID, Stripe coupon ID, or Stripe promotion code. (optional)
   * @param successUrl - URL to redirect to after successful checkout. (optional)
   * @param checkoutSessionParams - Additional parameters to pass into the creation of the Stripe checkout session. (optional)
   * @param redirectMode - Controls when to return a checkout URL. 'always' returns a URL even if payment succeeds, 'if_required' only when payment action is needed, 'never' disables redirects. (optional)
   * @param newBillingSubscription - Only applicable when the customer has an existing Stripe subscription. If true, creates a new separate subscription instead of merging into the existing one. (optional)
   *
   * @returns A billing response with customer ID, invoice details, and payment URL (if checkout required).
   */
  async multiAttach(
    request: models.MultiAttachParams,
    options?: RequestOptions,
  ): Promise<models.MultiAttachResponse> {
    return unwrapAsync(billingMultiAttach(
      this,
      request,
      options,
    ));
  }

  /**
   * Previews the billing changes that would occur when attaching a plan, without actually making any changes.
   *
   * Use this endpoint to show customers what they will be charged before confirming a subscription change.
   *
   * @example
   * ```typescript
   * // Preview attaching a plan
   * const response = await client.billing.previewAttach({ customerId: "cus_123", planId: "pro_plan" });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plan to.
   * @param entityId - The ID of the entity to attach the plan to. (optional)
   * @param planId - The ID of the plan.
   * @param featureQuantities - If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan. (optional)
   * @param version - The version of the plan to attach. (optional)
   * @param customize - Customize the plan to attach. Can override the price, items, free trial, or a combination. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method. (optional)
   * @param prorationBehavior - How to handle proration when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'none' skips creating any charges. (optional)
   * @param discounts - List of discounts to apply. Each discount can be an Autumn reward ID, Stripe coupon ID, or Stripe promotion code. (optional)
   * @param successUrl - URL to redirect to after successful checkout. (optional)
   * @param newBillingSubscription - Only applicable when the customer has an existing Stripe subscription. If true, creates a new separate subscription instead of merging into the existing one. (optional)
   * @param planSchedule - When the plan change should take effect. 'immediate' applies now, 'end_of_cycle' schedules for the end of the current billing cycle. By default, upgrades are immediate and downgrades are scheduled. (optional)
   * @param checkoutSessionParams - Additional parameters to pass into the creation of the Stripe checkout session. (optional)
   *
   * @returns A preview response with line items, totals, and effective dates for the proposed changes.
   */
  async previewAttach(
    request: models.PreviewAttachParams,
    options?: RequestOptions,
  ): Promise<models.PreviewAttachResponse> {
    return unwrapAsync(billingPreviewAttach(
      this,
      request,
      options,
    ));
  }

  /**
   * Previews the billing changes that would occur when attaching multiple plans, without actually making any changes.
   *
   * Use this endpoint to show customers what they will be charged before confirming a multi-plan subscription.
   *
   * @example
   * ```typescript
   * // Preview attaching multiple plans
   * const response = await client.billing.previewMultiAttach({ customerId: "cus_123", plans: [{"planId":"pro_plan"},{"planId":"addon_seats","featureQuantities":[{"featureId":"seats","quantity":5}]}] });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plans to.
   * @param entityId - The ID of the entity to attach the plans to. (optional)
   * @param plans - The list of plans to attach to the customer.
   * @param freeTrial - Free trial configuration applied to all plans. Pass an object to set a custom trial, or null to remove any trial. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. (optional)
   * @param discounts - List of discounts to apply. Each discount can be an Autumn reward ID, Stripe coupon ID, or Stripe promotion code. (optional)
   * @param successUrl - URL to redirect to after successful checkout. (optional)
   * @param checkoutSessionParams - Additional parameters to pass into the creation of the Stripe checkout session. (optional)
   * @param redirectMode - Controls when to return a checkout URL. 'always' returns a URL even if payment succeeds, 'if_required' only when payment action is needed, 'never' disables redirects. (optional)
   * @param newBillingSubscription - Only applicable when the customer has an existing Stripe subscription. If true, creates a new separate subscription instead of merging into the existing one. (optional)
   *
   * @returns A preview response with line items, totals, and effective dates for the proposed multi-plan attachment.
   */
  async previewMultiAttach(
    request: models.PreviewMultiAttachParams,
    options?: RequestOptions,
  ): Promise<models.PreviewMultiAttachResponse> {
    return unwrapAsync(billingPreviewMultiAttach(
      this,
      request,
      options,
    ));
  }

  /**
   * Updates an existing subscription. Use to modify feature quantities, cancel, or change plan configuration.
   *
   * Use this endpoint to update prepaid quantities, cancel a subscription (immediately or at end of cycle), or modify subscription settings.
   *
   * @example
   * ```typescript
   * // Update prepaid feature quantity
   * const response = await client.billing.update({ customerId: "cus_123", planId: "pro_plan", featureQuantities: [{"featureId":"seats","quantity":10}] });
   * ```
   *
   * @example
   * ```typescript
   * // Cancel a subscription at end of billing cycle
   * const response = await client.billing.update({ customerId: "cus_123", planId: "pro_plan", cancelAction: "cancel_end_of_cycle" });
   * ```
   *
   * @example
   * ```typescript
   * // Uncancel a subscription at the end of the billing cycle
   * const response = await client.billing.update({ customerId: "cus_123", planId: "pro_plan", cancelAction: "uncancel" });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plan to.
   * @param entityId - The ID of the entity to attach the plan to. (optional)
   * @param featureQuantities - If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan. (optional)
   * @param version - The version of the plan to attach. (optional)
   * @param customize - Customize the plan to attach. Can override the price, items, free trial, or a combination. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method. (optional)
   * @param prorationBehavior - How to handle proration when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'none' skips creating any charges. (optional)
   * @param cancelAction - Action to perform for cancellation. 'cancel_immediately' cancels now with prorated refund, 'cancel_end_of_cycle' cancels at period end, 'uncancel' reverses a pending cancellation. (optional)
   *
   * @returns A billing response with customer ID, invoice details, and payment URL (if next action is required).
   */
  async update(
    request: models.UpdateSubscriptionParams,
    options?: RequestOptions,
  ): Promise<models.BillingUpdateResponse> {
    return unwrapAsync(billingUpdate(
      this,
      request,
      options,
    ));
  }

  /**
   * Previews the billing changes that would occur when updating a subscription, without actually making any changes.
   *
   * Use this endpoint to show customers prorated charges or refunds before confirming subscription modifications.
   *
   * @example
   * ```typescript
   * // Preview updating seat quantity
   * const response = await client.billing.previewUpdate({ customerId: "cus_123", planId: "pro_plan", featureQuantities: [{"featureId":"seats","quantity":15}] });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plan to.
   * @param entityId - The ID of the entity to attach the plan to. (optional)
   * @param featureQuantities - If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan. (optional)
   * @param version - The version of the plan to attach. (optional)
   * @param customize - Customize the plan to attach. Can override the price, items, free trial, or a combination. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method. (optional)
   * @param prorationBehavior - How to handle proration when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'none' skips creating any charges. (optional)
   * @param cancelAction - Action to perform for cancellation. 'cancel_immediately' cancels now with prorated refund, 'cancel_end_of_cycle' cancels at period end, 'uncancel' reverses a pending cancellation. (optional)
   *
   * @returns A preview response with line items showing prorated charges or credits for the proposed changes.
   */
  async previewUpdate(
    request: models.PreviewUpdateParams,
    options?: RequestOptions,
  ): Promise<models.PreviewUpdateResponse> {
    return unwrapAsync(billingPreviewUpdate(
      this,
      request,
      options,
    ));
  }

  /**
   * Create a billing portal session for a customer to manage their subscription.
   */
  async openCustomerPortal(
    request: models.OpenCustomerPortalParams,
    options?: RequestOptions,
  ): Promise<models.OpenCustomerPortalResponse> {
    return unwrapAsync(billingOpenCustomerPortal(
      this,
      request,
      options,
    ));
  }

  /**
   * Create a payment setup session for a customer to add or update their payment method.
   */
  async setupPayment(
    request: models.SetupPaymentParams,
    options?: RequestOptions,
  ): Promise<models.SetupPaymentResponse> {
    return unwrapAsync(billingSetupPayment(
      this,
      request,
      options,
    ));
  }
}
