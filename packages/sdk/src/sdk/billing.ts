/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { billingAttach } from "../funcs/billing-attach.js";
import { billingOpenCustomerPortal } from "../funcs/billing-open-customer-portal.js";
import { billingPreviewAttach } from "../funcs/billing-preview-attach.js";
import { billingPreviewUpdate } from "../funcs/billing-preview-update.js";
import { billingSetupPayment } from "../funcs/billing-setup-payment.js";
import { billingUpdate } from "../funcs/billing-update.js";
import { ClientSDK, RequestOptions } from "../lib/sdks.js";
import * as models from "../models/index.js";
import { unwrapAsync } from "../types/fp.js";

export class Billing extends ClientSDK {
  /**
   * Attaches a plan to a customer. Handles new subscriptions, upgrades and downgrades.
   *
   * Use this endpoint to subscribe a customer to a plan, upgrade/downgrade between plans, or add an add-on product.
   *
   * @example
   * ```typescript
   * // Attach a plan to a customer
   * const response = await client.billing.attach({ customerId: "cus_123", planId: "pro_plan" });
   * ```
   *
   * @example
   * ```typescript
   * // Attach with a free trial
   * const response = await client.billing.attach({ customerId: "cus_123", planId: "pro_plan", freeTrial: {"durationLength":14,"durationType":"day"} });
   * ```
   *
   * @example
   * ```typescript
   * // Attach with custom pricing
   * const response = await client.billing.attach({ customerId: "cus_123", planId: "pro_plan", customize: {"price":{"amount":4900,"interval":"month"}} });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plan to.
   * @param entityId - The ID of the entity to attach the plan to. (optional)
   * @param planId - The ID of the plan.
   * @param featureQuantities - If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan. (optional)
   * @param version - The version of the plan to attach. (optional)
   * @param freeTrial - Override the plan's default free trial. Pass an object to set a custom trial, or null to remove the trial entirely. (optional)
   * @param customize - Customize the plan to attach. Can either override the price of the plan, the items in the plan, or both. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method. (optional)
   * @param billingBehavior - How to handle billing when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'next_cycle_only' skips creating any charges and applies the change at the next billing cycle. (optional)
   * @param discounts - List of discounts to apply. Each discount can be an Autumn reward ID, Stripe coupon ID, or Stripe promotion code. (optional)
   * @param successUrl - URL to redirect to after successful checkout. (optional)
   * @param newBillingSubscription - Only applicable when the customer has an existing Stripe subscription. If true, creates a new separate subscription instead of merging into the existing one. (optional)
   * @param planSchedule - When the plan change should take effect. 'immediate' applies now, 'end_of_cycle' schedules for the end of the current billing cycle. By default, upgrades are immediate and downgrades are scheduled. (optional)
   *
   * @returns A billing response with customer ID, invoice details, and payment URL (if checkout required).
   */
  async attach(
    request: models.AttachParams,
    options?: RequestOptions,
  ): Promise<models.BillingAttachResponse> {
    return unwrapAsync(billingAttach(
      this,
      request,
      options,
    ));
  }

  /**
   * Previews the billing changes that would occur when attaching a plan, without actually making any changes.
   *
   * Use this endpoint to show customers what they will be charged before confirming a subscription change.
   *
   * @example
   * ```typescript
   * // Preview attaching a plan
   * const response = await client.billing.previewAttach({ customerId: "cus_123", planId: "pro_plan" });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plan to.
   * @param entityId - The ID of the entity to attach the plan to. (optional)
   * @param planId - The ID of the plan.
   * @param featureQuantities - If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan. (optional)
   * @param version - The version of the plan to attach. (optional)
   * @param freeTrial - Override the plan's default free trial. Pass an object to set a custom trial, or null to remove the trial entirely. (optional)
   * @param customize - Customize the plan to attach. Can either override the price of the plan, the items in the plan, or both. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method. (optional)
   * @param billingBehavior - How to handle billing when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'next_cycle_only' skips creating any charges and applies the change at the next billing cycle. (optional)
   * @param discounts - List of discounts to apply. Each discount can be an Autumn reward ID, Stripe coupon ID, or Stripe promotion code. (optional)
   * @param successUrl - URL to redirect to after successful checkout. (optional)
   * @param newBillingSubscription - Only applicable when the customer has an existing Stripe subscription. If true, creates a new separate subscription instead of merging into the existing one. (optional)
   * @param planSchedule - When the plan change should take effect. 'immediate' applies now, 'end_of_cycle' schedules for the end of the current billing cycle. By default, upgrades are immediate and downgrades are scheduled. (optional)
   *
   * @returns A preview response with line items, totals, and effective dates for the proposed changes.
   */
  async previewAttach(
    request: models.PreviewAttachParams,
    options?: RequestOptions,
  ): Promise<models.PreviewAttachResponse> {
    return unwrapAsync(billingPreviewAttach(
      this,
      request,
      options,
    ));
  }

  /**
   * Updates an existing subscription. Use to modify feature quantities, cancel, or change plan configuration.
   *
   * Use this endpoint to update prepaid quantities, cancel a subscription (immediately or at end of cycle), or modify subscription settings.
   *
   * @example
   * ```typescript
   * // Update prepaid feature quantity
   * const response = await client.billing.update({ customerId: "cus_123", planId: "pro_plan", featureQuantities: [{"featureId":"seats","quantity":10}] });
   * ```
   *
   * @example
   * ```typescript
   * // Cancel a subscription at end of billing cycle
   * const response = await client.billing.update({ customerId: "cus_123", planId: "pro_plan", cancelAction: "cancel_end_of_cycle" });
   * ```
   *
   * @example
   * ```typescript
   * // Uncancel a subscription at the end of the billing cycle
   * const response = await client.billing.update({ customerId: "cus_123", planId: "pro_plan", cancelAction: "uncancel" });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plan to.
   * @param entityId - The ID of the entity to attach the plan to. (optional)
   * @param featureQuantities - If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan. (optional)
   * @param version - The version of the plan to attach. (optional)
   * @param freeTrial - Override the plan's default free trial. Pass an object to set a custom trial, or null to remove the trial entirely. (optional)
   * @param customize - Customize the plan to attach. Can either override the price of the plan, the items in the plan, or both. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method. (optional)
   * @param billingBehavior - How to handle billing when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'next_cycle_only' skips creating any charges and applies the change at the next billing cycle. (optional)
   * @param cancelAction - Action to perform for cancellation. 'cancel_immediately' cancels now with prorated refund, 'cancel_end_of_cycle' cancels at period end, 'uncancel' reverses a pending cancellation. (optional)
   *
   * @returns A billing response with customer ID, invoice details, and payment URL (if next action is required).
   */
  async update(
    request: models.UpdateSubscriptionParams,
    options?: RequestOptions,
  ): Promise<models.BillingUpdateResponse> {
    return unwrapAsync(billingUpdate(
      this,
      request,
      options,
    ));
  }

  /**
   * Previews the billing changes that would occur when updating a subscription, without actually making any changes.
   *
   * Use this endpoint to show customers prorated charges or refunds before confirming subscription modifications.
   *
   * @example
   * ```typescript
   * // Preview updating seat quantity
   * const response = await client.billing.previewUpdate({ customerId: "cus_123", planId: "pro_plan", featureQuantities: [{"featureId":"seats","quantity":15}] });
   * ```
   *
   * @param customerId - The ID of the customer to attach the plan to.
   * @param entityId - The ID of the entity to attach the plan to. (optional)
   * @param featureQuantities - If this plan contains prepaid features, use this field to specify the quantity of each prepaid feature. This quantity includes the included amount and billing units defined when setting up the plan. (optional)
   * @param version - The version of the plan to attach. (optional)
   * @param freeTrial - Override the plan's default free trial. Pass an object to set a custom trial, or null to remove the trial entirely. (optional)
   * @param customize - Customize the plan to attach. Can either override the price of the plan, the items in the plan, or both. (optional)
   * @param invoiceMode - Invoice mode creates a draft or open invoice and sends it to the customer, instead of charging their card immediately. This uses Stripe's send_invoice collection method. (optional)
   * @param billingBehavior - How to handle billing when updating an existing subscription. 'prorate_immediately' charges/credits prorated amounts now, 'next_cycle_only' skips creating any charges and applies the change at the next billing cycle. (optional)
   * @param cancelAction - Action to perform for cancellation. 'cancel_immediately' cancels now with prorated refund, 'cancel_end_of_cycle' cancels at period end, 'uncancel' reverses a pending cancellation. (optional)
   *
   * @returns A preview response with line items showing prorated charges or credits for the proposed changes.
   */
  async previewUpdate(
    request: models.PreviewUpdateParams,
    options?: RequestOptions,
  ): Promise<models.PreviewUpdateResponse> {
    return unwrapAsync(billingPreviewUpdate(
      this,
      request,
      options,
    ));
  }

  /**
   * Create a billing portal session for a customer to manage their subscription.
   */
  async openCustomerPortal(
    request: models.OpenCustomerPortalParams,
    options?: RequestOptions,
  ): Promise<models.OpenCustomerPortalResponse> {
    return unwrapAsync(billingOpenCustomerPortal(
      this,
      request,
      options,
    ));
  }

  /**
   * Create a payment setup session for a customer to add or update their payment method.
   */
  async setupPayment(
    request: models.SetupPaymentParams,
    options?: RequestOptions,
  ): Promise<models.SetupPaymentResponse> {
    return unwrapAsync(billingSetupPayment(
      this,
      request,
      options,
    ));
  }
}
